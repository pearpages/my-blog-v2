(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{218:function(e,n,r){"use strict";r.r(n),r.d(n,"frontMatter",(function(){return i})),r.d(n,"metadata",(function(){return a})),r.d(n,"toc",(function(){return c})),r.d(n,"default",(function(){return p}));var t=r(3),s=r(7),o=(r(0),r(229)),i={slug:"dependency injection",title:"Dependency Injection",author:"pere pages",author_image_url:"https://avatars2.githubusercontent.com/u/3802915?s=400&v=4",tags:["js"]},a={permalink:"/dependency injection",editUrl:"https://github.com/pearpages/my-blog/edit/master/blog/2021-10-18-dependency-injection.md",source:"@site/blog/2021-10-18-dependency-injection.md",description:"DI is a pattern where, instead of creating or requiring dependencies directly inside a module, we pass them as parameters or reference.",date:"2021-10-18T00:00:00.000Z",tags:[{label:"js",permalink:"/tags/js"}],title:"Dependency Injection",readingTime:1.12,truncated:!1,prevItem:{title:"3 Typescript tricks",permalink:"/3 typescript tricks"},nextItem:{title:"About Javascript",permalink:"/about javascript"}},c=[{value:"Functional Version (with Typescript)",id:"functional-version-with-typescript",children:[]},{value:"Resources",id:"resources",children:[]}],u={toc:c};function p(e){var n=e.components,r=Object(s.a)(e,["components"]);return Object(o.b)("wrapper",Object(t.a)({},u,r,{components:n,mdxType:"MDXLayout"}),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"DI is a pattern where, instead of creating or requiring dependencies directly inside a module, we pass them as parameters or reference.")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Program to an interface, not an implementation.")),Object(o.b)("p",null,"A second problem is the testability of this module. If we wanted to find out if getUsers method works, we would need to stub usersRepository using Sinon, Jest.mock or any other stubbing library."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"const User = require('./User');\n\nfunction UsersService(usersRepository) {\n  async function getUsers() {\n    return usersRepository.findAll();\n  }\n  \n  async function addUser(userData) {\n    const user = new User(userData);\n  \n    return usersRepository.addUser(user);\n  }\n  \n  return {\n    getUsers,\n    addUser\n  };\n}\n\nmodule.exports = UsersService\n")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"const UsersService = require('./users');\nconst assert = require('assert');\n\ndescribe('Users service', () => {\n  it('gets users', async () => {\n    const users = [{\n      id: 1,\n      firstname: 'Joe',\n      lastname: 'Doe'\n    }];\n\n    const usersRepository = {\n      findAll: async () => {\n        return users\n      }\n    };\n\n    const usersService = new UsersService(usersRepository);\n  \n    assert.deepEqual(await usersService.getUsers(), users);\n  });\n});\n")),Object(o.b)("h2",{id:"functional-version-with-typescript"},"Functional Version (with Typescript)"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},"type UsersDependencies = {\n  usersRepository: UsersRepository\n  mailer: Mailer\n  logger: Logger\n};\n\nexport const usersService = (dependencies: UsersDependencies) => {\n  const findAll = () => dependencies.usersRepository.findAll();\n  const addUser = user => {\n    await dependencies.usersRepository.addUser(user)\n    dependencies.logger.info(`User created: ${user}`)\n    await dependencies.mailer.sendConfirmationLink(user)\n    dependencies.logger.info(`Confirmation link sent: ${user}`)\n  };\n\n  return {\n    findAll,\n    addUser\n  };\n}\n\nconst service = usersService({\n  usersRepository,\n  mailer,\n  logger\n});\n")),Object(o.b)("h2",{id:"resources"},"Resources"),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://tsh.io/blog/dependency-injection-in-node-js/"},"Original Post")))}p.isMDXComponent=!0},229:function(e,n,r){"use strict";r.d(n,"a",(function(){return l})),r.d(n,"b",(function(){return f}));var t=r(0),s=r.n(t);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function i(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?i(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function c(e,n){if(null==e)return{};var r,t,s=function(e,n){if(null==e)return{};var r,t,s={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(s[r]=e[r]);return s}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var u=s.a.createContext({}),p=function(e){var n=s.a.useContext(u),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},l=function(e){var n=p(e.components);return s.a.createElement(u.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return s.a.createElement(s.a.Fragment,{},n)}},b=s.a.forwardRef((function(e,n){var r=e.components,t=e.mdxType,o=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),l=p(r),b=t,f=l["".concat(i,".").concat(b)]||l[b]||d[b]||o;return r?s.a.createElement(f,a(a({ref:n},u),{},{components:r})):s.a.createElement(f,a({ref:n},u))}));function f(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=r.length,i=new Array(o);i[0]=b;var a={};for(var c in n)hasOwnProperty.call(n,c)&&(a[c]=n[c]);a.originalType=e,a.mdxType="string"==typeof e?e:t,i[1]=a;for(var u=2;u<o;u++)i[u]=r[u];return s.a.createElement.apply(null,i)}return s.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"}}]);